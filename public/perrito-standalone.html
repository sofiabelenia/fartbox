<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Cena del Perrito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body {
            font-family: 'Fredoka One', cursive;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        @keyframes pop-sipo {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); opacity: 1; }
            70% { transform: scale(0.9) rotate(-5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes pop-fome {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-shake {
            animation: shake 0.8s cubic-bezier(.36,.07,.19,.97) both;
        }

        .animate-sipo {
            animation: pop-sipo 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .animate-fome {
            animation: pop-fome 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen bg-sky-50">

<div id="app" class="min-h-screen bg-sky-50 font-sans flex flex-col items-center justify-center p-4">

    <!-- Header -->
    <div class="w-full max-w-md flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-md">
        <div class="flex items-center gap-2 text-amber-600 font-bold">
            <span>ğŸ†</span>
            <span id="levelDisplay">Nivel -/5</span>
        </div>
        <div class="text-2xl font-black text-slate-700">
            <span id="scoreDisplay">0</span> pts
        </div>
        <div class="flex items-center gap-2 text-rose-500 font-bold">
            <span>â¤ï¸</span>
            <span id="livesDisplay">1</span>
        </div>
    </div>

    <!-- Main Game Area -->
    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden relative min-h-[500px] flex flex-col">

        <!-- Dog Scene -->
        <div id="dogScene" class="bg-sky-100 p-8 flex flex-col items-center justify-center border-b-4 border-sky-200 h-64 transition-colors duration-500 relative overflow-visible">

            <!-- SIPO Animation -->
            <div id="sipoText" class="absolute top-4 right-10 z-50 animate-sipo pointer-events-none hidden">
                <span class="text-6xl font-black text-amber-500 drop-shadow-xl select-none"
                      style="text-shadow: 3px 3px 0px white, -1px -1px 0 #fff; -webkit-text-stroke: 2px white;">
                    Â¡SIPO!
                </span>
            </div>

            <!-- Dog Container -->
            <div class="mb-4">
                <div id="dogEmoji" class="transition-all duration-500 rounded-full p-8 border-4 border-amber-500 shadow-xl bg-amber-100">
                    <span class="text-8xl">ğŸ¶</span>
                </div>
            </div>

            <!-- Message -->
            <p id="dogMessage" class="text-center font-bold text-lg px-4 py-2 rounded-full shadow-sm bg-white text-slate-600">
                Â¡Hola! Tengo hambre.
            </p>
        </div>

        <!-- Game Screens Container -->
        <div class="flex-1 p-6 bg-slate-50 flex items-center justify-center">

            <!-- Menu Screen -->
            <div id="menuScreen" class="text-center space-y-4">
                <h1 class="text-3xl font-black text-amber-600 mb-2">La Cena del Perrito</h1>
                <p class="text-slate-600 mb-6">
                    Elige una caja con comida buena.<br/>
                    Â¡Cuidado! Una caja tiene comida podrida.<br/>
                    <span class="text-sm font-semibold text-rose-500">Cada nivel hay menos cajas... Â¡MÃ¡s riesgo!</span>
                </p>
                <button id="startButton" class="bg-amber-500 hover:bg-amber-600 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition active:scale-95 flex items-center gap-2 mx-auto">
                    ğŸ¦´ Jugar
                </button>
            </div>

            <!-- Playing Screen -->
            <div id="playingScreen" class="hidden w-full">
                <div id="boxesGrid" class="grid gap-4"></div>
            </div>

            <!-- Game Over Screen -->
            <div id="gameoverScreen" class="hidden text-center relative">
                <!-- FOME Text Overlay -->
                <div id="fomeText" class="fixed inset-0 flex items-center justify-center z-50 pointer-events-none hidden">
                    <div class="animate-fome">
                        <h1 class="text-9xl font-black text-green-500 drop-shadow-2xl"
                            style="text-shadow: 5px 5px 0px rgba(5, 150, 105, 0.8), 10px 10px 20px rgba(0, 0, 0, 0.5); -webkit-text-stroke: 3px #059669;">
                            FOME
                        </h1>
                    </div>
                </div>

                <h2 class="text-3xl font-bold text-red-500 mb-2">ğŸ¤®</h2>
                <p class="text-slate-600 mb-6">El perrito comiÃ³ algo malo.</p>
                <div class="bg-white p-4 rounded-xl shadow-inner mb-6">
                    <p class="text-sm text-slate-400 uppercase tracking-wide">PuntuaciÃ³n Final</p>
                    <p class="text-4xl font-black text-slate-700"><span id="finalScore">0</span></p>
                </div>
                <button id="retryButton" class="bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition active:scale-95 flex items-center gap-2 mx-auto">
                    ğŸ”„ Intentar de nuevo
                </button>
            </div>

            <!-- Victory Screen -->
            <div id="victoryScreen" class="hidden text-center">
                <h2 class="text-3xl font-bold text-green-500 mb-2">Â¡Panza Llena! ğŸ‰</h2>
                <p class="text-slate-600 mb-6">Â¡Completaste todos los niveles!</p>
                <div class="bg-yellow-50 p-6 rounded-xl border-2 border-yellow-200 shadow-sm mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-10">
                        <span class="text-8xl">ğŸ†</span>
                    </div>
                    <p class="text-sm text-yellow-600 uppercase tracking-wide font-bold">PuntuaciÃ³n Total</p>
                    <p class="text-5xl font-black text-amber-500"><span id="victoryScore">0</span></p>
                </div>
                <button id="playAgainButton" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition active:scale-95 mx-auto">
                    Jugar otra vez
                </button>
            </div>

        </div>
    </div>

    <p class="mt-6 text-slate-400 text-sm font-medium">
        Juego creado para probar tu suerte ğŸ€
    </p>
</div>

<script>
    const TOTAL_LEVELS = 5;
    const LEVEL_CONFIG = {
        1: 6,
        2: 5,
        3: 4,
        4: 3,
        5: 2
    };

    // Game state
    let gameState = 'menu';
    let level = 1;
    let boxes = [];
    let dogStatus = 'happy';
    let score = 0;
    let currentAudio = [];

    // DOM elements
    const screens = {
        menu: document.getElementById('menuScreen'),
        playing: document.getElementById('playingScreen'),
        gameover: document.getElementById('gameoverScreen'),
        victory: document.getElementById('victoryScreen')
    };

    // Initialize
    document.getElementById('startButton').addEventListener('click', startGame);
    document.getElementById('retryButton').addEventListener('click', startGame);
    document.getElementById('playAgainButton').addEventListener('click', startGame);

    function showScreen(screenName) {
        Object.keys(screens).forEach(key => {
            screens[key].classList.add('hidden');
        });
        screens[screenName].classList.remove('hidden');
    }

    function updateDog(status) {
        dogStatus = status;
        const dogEmoji = document.getElementById('dogEmoji');
        const emojis = {
            'happy': 'ğŸ¶',
            'super-happy': 'ğŸ©',
            'eating': 'ğŸ˜‹',
            'sick': 'ğŸ¤¢',
            'neutral': 'ğŸ•'
        };

        const animations = {
            'happy': 'animate-bounce',
            'super-happy': 'animate-spin',
            'eating': 'animate-pulse',
            'sick': 'animate-shake',
            'neutral': ''
        };

        const bgColors = {
            'happy': 'bg-amber-100',
            'super-happy': 'bg-yellow-200',
            'eating': 'bg-green-100',
            'sick': 'bg-green-200',
            'neutral': 'bg-amber-100'
        };

        dogEmoji.className = `transition-all duration-500 rounded-full p-8 border-4 border-amber-500 shadow-xl ${bgColors[status]} ${animations[status]} relative`;
        dogEmoji.querySelector('span').textContent = emojis[status];
    }

    function setMessage(msg) {
        const messageEl = document.getElementById('dogMessage');
        messageEl.textContent = msg;

        if (dogStatus === 'sick') {
            messageEl.className = 'text-center font-bold text-lg px-4 py-2 rounded-full shadow-sm bg-red-100 text-red-600';
        } else if (dogStatus === 'eating') {
            messageEl.className = 'text-center font-bold text-lg px-4 py-2 rounded-full shadow-sm bg-green-100 text-green-700';
        } else {
            messageEl.className = 'text-center font-bold text-lg px-4 py-2 rounded-full shadow-sm bg-white text-slate-600';
        }
    }

    function updateUI() {
        document.getElementById('scoreDisplay').textContent = score;
        document.getElementById('levelDisplay').textContent = gameState === 'menu' ? 'Nivel -/5' : `Nivel ${level}/${TOTAL_LEVELS}`;
        document.getElementById('livesDisplay').textContent = gameState === 'gameover' ? '0' : '1';
    }

    function showSipo() {
        const sipoEl = document.getElementById('sipoText');
        sipoEl.classList.remove('hidden');
        setTimeout(() => {
            sipoEl.classList.add('hidden');
        }, 1000);
    }

    function showFome() {
        const fomeEl = document.getElementById('fomeText');
        fomeEl.classList.remove('hidden');
    }

    function hideFome() {
        const fomeEl = document.getElementById('fomeText');
        fomeEl.classList.add('hidden');
    }

    function playFomeSound() {
        const audio1 = new Audio('peos/fart-sound-effect-16-11093.mp3');
        audio1.volume = 0.5;
        audio1.play().catch(err => console.log('Audio play failed:', err));

        const audio2 = new Audio('fome.mp4');
        audio2.volume = 0.8;
        audio2.play().catch(err => console.log('Audio play failed:', err));

        currentAudio = [audio1, audio2];
    }

    function stopAllAudio() {
        currentAudio.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
        currentAudio = [];
    }

    function startGame() {
        stopAllAudio();
        hideFome();

        gameState = 'playing';
        level = 1;
        score = 0;
        dogStatus = 'happy';

        updateUI();
        updateDog('happy');
        startLevel(1);
    }

    function startLevel(currentLevel) {
        const numBoxes = LEVEL_CONFIG[currentLevel];
        const poisonIndex = Math.floor(Math.random() * numBoxes);

        boxes = Array(numBoxes).fill(null).map((_, index) => ({
            id: index,
            isPoison: index === poisonIndex,
            isOpen: false,
            content: index === poisonIndex ? 'poison' : 'food'
        }));

        updateDog('neutral');
        setMessage('Â¡Encuentra la comida rica! Solo 1 tiene veneno.');
        showScreen('playing');
        renderBoxes();
    }

    function renderBoxes() {
        const grid = document.getElementById('boxesGrid');
        const cols = boxes.length > 4 ? 3 : boxes.length > 2 ? 2 : boxes.length;
        grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        grid.innerHTML = '';

        boxes.forEach((box, index) => {
            const btn = document.createElement('button');
            btn.className = 'relative aspect-square rounded-xl shadow-md transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg bg-amber-200 border-b-4 border-amber-400 cursor-pointer';
            btn.innerHTML = '<div class="absolute inset-0 flex items-center justify-center"><div class="text-4xl">ğŸ“¦</div></div>';
            btn.addEventListener('click', () => handleBoxClick(index));
            btn.dataset.index = index;
            grid.appendChild(btn);
        });
    }

    function handleBoxClick(index) {
        if (gameState !== 'playing') return;

        const box = boxes[index];
        if (box.isOpen) return;

        box.isOpen = true;
        gameState = 'processing';

        const btn = document.querySelector(`[data-index="${index}"]`);
        if (box.isPoison) {
            btn.innerHTML = '<div class="absolute inset-0 rounded-xl flex items-center justify-center border-4 bg-red-100 border-red-400"><div class="text-4xl animate-bounce">ğŸ’€</div></div>';
        } else {
            btn.innerHTML = '<div class="absolute inset-0 rounded-xl flex items-center justify-center border-4 bg-green-100 border-green-400"><div class="text-4xl animate-bounce">ğŸ¦´</div></div>';
        }

        if (box.isPoison) {
            // PerdiÃ³
            updateDog('sick');
            setMessage('Â¡Oh no! Â¡Estaba podrido!');

            setTimeout(() => {
                // Revelar todas las cajas
                boxes.forEach((b, i) => {
                    b.isOpen = true;
                    const boxBtn = document.querySelector(`[data-index="${i}"]`);
                    if (b.isPoison) {
                        boxBtn.innerHTML = '<div class="absolute inset-0 rounded-xl flex items-center justify-center border-4 bg-red-100 border-red-400"><div class="text-4xl animate-bounce">ğŸ’€</div></div>';
                    } else {
                        boxBtn.innerHTML = '<div class="absolute inset-0 rounded-xl flex items-center justify-center border-4 bg-green-100 border-green-400"><div class="text-4xl animate-bounce">ğŸ¦´</div></div>';
                    }
                });

                gameState = 'gameover';
                updateUI();
                document.getElementById('finalScore').textContent = score;
                showScreen('gameover');

                // Reproducir sonidos y mostrar FOME
                playFomeSound();
                showFome();
            }, 1500);

        } else {
            // GanÃ³
            updateDog('eating');
            setMessage('Â¡Ã‘am Ã±am! Â¡QuÃ© rico!');
            showSipo();

            score += 100 * level;
            updateUI();

            setTimeout(() => {
                if (level < TOTAL_LEVELS) {
                    level++;
                    updateDog('happy');
                    startLevel(level);
                } else {
                    updateDog('super-happy');
                    gameState = 'victory';
                    document.getElementById('victoryScore').textContent = score;
                    showScreen('victory');
                }
            }, 1500);
        }
    }

    // Initialize UI
    updateUI();
</script>

<script src="/game-wrapper.js"></script>
</body>
</html>
